<html>
  <head>
    <script src="/republican_stats/js/jquery-2.2.3.min.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>


    <script type="text/javascript">
      google.charts.load('current', { 'packages': ['map'] });



      $(document).ready(()=>{
        

        

        var requestMy=$.ajax({

          url:"/api/v1/republican_stats?apikey=multiPlan_C4_sos-2016-12-vss_ag",
          type:"GET",
          contentType : "application/json"
        });

        var requestApi=$.ajax({

          url:"https://wheresitup.p.mashape.com/sources",
          type:"GET",
          contentType : "application/json"
        });
        requestMy.done((myData)=>{
          requestApi.done((apiData)=>{
            google.charts.setOnLoadCallback(drawMap);

            function drawMap() {
              
              console.log("Data From Api's Server: "+apiData);
              var dataForWidget=[["Country","Location"]];


              for (i=0;i<myData.length;i++){
                var myItem=myData[i];
                console.log("myItem: "+myItem);
                
                for (j=0;j<apiData.length;j++){
                  var apiItem=apiData[j]; 
                  if(myItem.country==apiItem.country){
                    var itemForWidget =[myItem.country,apiItem.location];
                    dataForWidget.push(itemForWidget);
                  }
                }
              }
              console.log("Data far widget: "+dataForWidget);

              var data = google.visualization.arrayToDataTable(dataForWidget);  //transformation from data
              var options = { showTip: true };
              var map = new google.visualization.Map(document.getElementById('chart_div'));
              map.draw(data, options);
            }
          });

        });

      });
    </script>
  </head>

  <body>
    <h1>Integration with Where is it Up</h1>
    <p>Our API exposes site monitoring tools in 89 cities across 47 different countries on 6 continents</p>
    <div id="series_chart_div" style="width: 1300px; height: 700px;"></div>
  </body>
</html>
