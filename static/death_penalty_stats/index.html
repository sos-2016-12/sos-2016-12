<!DOCTYPE html>
<html>

	<head>
		<link rel="stylesheet" type="text/css" href="../data/death_penalty_stats/css/bootstrap.css">
		<style type="text/css">
 			body { background: #FCFCC1; !important; } /* Adding !important forces the browser to overwrite the default style applied by Bootstrap */
 		</style> 
		<script src="https://code.jquery.com/jquery-1.12.2.min.js"></script>
		<script>
			$(document).ready(function(){
				console.log("JQuery ready!");


				$('#button-ld-ini').click(function(){

					var apikey = $("#apikey").val();

					var request = $.ajax({

						  url: "http://sos-2016-12.herokuapp.com/api/v1/death_penalty_stats/loadInitialData?apikey="+apikey,
						  type: "GET",
						  contentType: "application/json",
  
					});

					request.done(function(data,status,jqXHR) {
					  // Tratamiento en caso de exito
					  $("#status").html(jqXHR.status);
					  $("#log").html("You loaded the initial data successfully.");

					});

					request.always(function(jqXHR, status) {
					  // Tratamiento en cualquier caso
					 if(status == "error") {
						$("#status").html(jqXHR.status);
					 	console.log(jqXHR.status);
					 	$("table").find("tr:gt(0)").remove();
					 	$("#log").html("error");
					}	

					});
				});





				$('#button-get').click(function(){

					var apikey = $("#apikey").val();

					var request = $.ajax({

						  url: "http://sos-2016-12.herokuapp.com/api/v1/death_penalty_stats?apikey="+apikey,
						  type: "GET",
						  contentType: "application/json",
  
					});

					request.done(function(data,status,jqXHR) {
					  // Tratamiento en caso de exito
					var trHTML = '';

                	$("table").find("tr:gt(0)").remove();

       				$.each(data, function (i, item) {
            
            		trHTML += '<tr><td>' + data[i].country + '</td><td>' + data[i].abolition_year + '</td><td>' + data[i].for_all_crimes + '</td><td>'
            			+ data[i].murder_rate_per_100k_people + '</td><td> <button type="button" id="button-upd" class="btn btn-primary" autocomplete="off"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> Update </button> </td><td> <button type="button" id="button-dlt" class="btn btn-primary" autocomplete="off"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span> Delete </button> </td></tr>';
       				 });
        
       				 $('#table').append(trHTML);
					 $("#status").html(jqXHR.status);
					 $("#log").html("done");

					});

					request.always(function(jqXHR, status) {
					  // Tratamiento en cualquier caso
					 if(status == "error") {
						$("#status").html(jqXHR.status);
					 	console.log(jqXHR.status);
					 	$("table").find("tr:gt(0)").remove();
					 	$("#log").html("error");
					}	

					});
				});




				$('#button-upd').click(function(){

					var apikey = $("#apikey").val();

					var request = $.ajax({

						  url: "http://sos-2016-12.herokuapp.com/api/v1/death_penalty_stats?apikey="+apikey,
						  type: "UPDATE",
						  contentType: "application/json",
  
					});


					request.done(function(data,status,jqXHR) {
					  // Tratamiento en caso de exito
					  
					 $("#status").html(jqXHR.status);
					 $("#log").html("done");

					});

					request.always(function(jqXHR, status) {
					  // Tratamiento en cualquier caso
					 if(status == "error") {
						$("#status").html(jqXHR.status);
					 	console.log(jqXHR.status);
					 	$("table").find("tr:gt(0)").remove();
					 	$("#log").html("error");
					}	

					});
				});




				$('#button-dlt').click(function(){

					var apikey = $("#apikey").val();

					var request = $.ajax({

						  url: "http://sos-2016-12.herokuapp.com/api/v1/death_penalty_stats?apikey="+apikey,
						  type: "DELETE",
						  contentType: "application/json",
  
					});


					request.done(function(data,status,jqXHR) {
					  // Tratamiento en caso de exito
					  
					 $("#status").html(jqXHR.status);
					 $("#log").html("done");

					});

					request.always(function(jqXHR, status) {
					  // Tratamiento en cualquier caso
					 if(status == "error") {
						$("#status").html(jqXHR.status);
					 	console.log(jqXHR.status);
					 	$("table").find("tr:gt(0)").remove();
					 	$("#log").html("error");
					}	

					});
				});


				$('#button-dlt-all').click(function(){

					var apikey = $("#apikey").val();

					var request = $.ajax({

						  url: "http://sos-2016-12.herokuapp.com/api/v1/death_penalty_stats?apikey="+apikey,
						  type: "DELETE",
						  contentType: "application/json",
  
					});


					request.done(function(data,status,jqXHR) {
					  // Tratamiento en caso de exito
					 
					 $("table").find("tr:gt(0)").remove();

					 $("#status").html(jqXHR.status);
					 $("#log").html("You deleted all resources.");

					});

					request.always(function(jqXHR, status) {
					  // Tratamiento en cualquier caso
					 if(status == "error") {
						$("#status").html(jqXHR.status);
					 	console.log(jqXHR.status);
					 	$("table").find("tr:gt(0)").remove();
					 	$("#log").html("error");
					}	

					});
				});

 			});
		</script>
	</head>

	<body><div class="container">
		<h1>JQuery REST Client</h1>
		</br>
		<button type="button" id="button-get" class="btn btn-primary" autocomplete="off"><span class="glyphicon glyphicon-triangle-right" aria-hidden="true"></span> GET Resources </button>
		<button type="button" id="button-ld-ini" class="btn btn-primary" autocomplete="off"><span class="glyphicon glyphicon-off" aria-hidden="true"></span> Load Initial Data </button>
		<label class="active" for="apikey"> Apikey </label>
		    <input id="apikey" name="apikey" type="text" value="1234">
		</br><hr/>
			<p class="lead">HTTP Status: <span id="status"></span> </p>
		<hr/>
			<span id="data">
				<table id="table" border="1" class="table table-hover table-condensed table-bordered">
					<tr class="info">
       					<th>Country</th>
         				<th>Abolition Year</th>
         				<th>For All Crimes?</th>
         				<th>Murder Rate Per 100k People</th>
         				<th>Update</th>
         				<th>Delete</th>
    				</tr>
				</table>
			</span>
			<button type="button" id="button-dlt-all" class="btn btn-primary" autocomplete="off"><span class="glyphicon glyphicon-fire" aria-hidden="true"></span> Delete All Data </button>
				<hr/>
			<p class="lead">Message: <span id="log"></span></p>
	</div></body>
</html>