<!DOCTYPE html>
<html>

	<head>
		<link rel="stylesheet" type="text/css" href="../data/death_penalty_stats/css/bootstrap.css">
		<style type="text/css">
 			body { background: #FCFCC1; !important; } /* Adding !important forces the browser to overwrite the default style applied by Bootstrap */
 		</style> 
		<script src="https://code.jquery.com/jquery-1.12.2.min.js"></script>
		<script>
			$(document).ready(function(){
				console.log("JQuery ready!");

				var id = 1;


				$('#button-ld-ini').click(function(){

					var apikey = $("#apikey").val();

					var request = $.ajax({

						  url: "http://sos-2016-12.herokuapp.com/api/v1/death_penalty_stats/loadInitialData?apikey="+apikey,
						  type: "GET",
						  contentType: "application/json",
  
					});

					request.done(function(data,status,jqXHR) {
					  // Tratamiento en caso de exito
					  $("#status").html(jqXHR.status);
					  $("#log").html("You loaded the initial data successfully.");

					});

					request.always(function(jqXHR, status) {
					  // Tratamiento en cualquier caso
					 if(status == "error") {
						$("#status").html(jqXHR.status);
					 	console.log(jqXHR.status);
					 	if (jqXHR.status == 401) {
					 		$("#log").html("The apikey you entered is not valid");
					 		alert('Apikey not valid');
					 	}else{
					 		$("#log").html("error");
					 	}
					}	

					});
				});





				$('#button-get').click(function(){

					var apikey = $("#apikey").val();

					var request = $.ajax({

						  url: "http://sos-2016-12.herokuapp.com/api/v1/death_penalty_stats?apikey="+apikey,
						  type: "GET",
						  contentType: "application/json",
  
					});

					request.done(function(data,status,jqXHR) {
					  // Tratamiento en caso de exito
					var trHTML = '';

                	$("table").find("tr:gt(0)").remove();

                	id = 1;

       				$.each(data, function (i, item) {
            
            		trHTML += '<tr id="'+id+'"><td>' + id +'</td><td>'+ data[i].country + '</td><td>' + data[i].abolition_year + '</td><td>' + data[i].for_all_crimes + '</td><td>'
            			+ data[i].murder_rate_per_100k_people + '</td><td> <button type="button" id="button-upd" class="btn btn-primary" autocomplete="off"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> Update </button> </td><td> <button type="button" id="button-dlt" class="btn btn-primary" autocomplete="off"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span> Delete </button> </td></tr>';
       				 id++;
       				 });
        
       				 $('#table').append(trHTML);
					 $("#status").html(jqXHR.status);
					 $("#log").html("done");

					});

					request.always(function(jqXHR, status) {
					  // Tratamiento en cualquier caso
					 if(status == "error") {
						$("#status").html(jqXHR.status);
					 	console.log(jqXHR.status);
					 	if (jqXHR.status == 401) {
					 		$("#log").html("The apikey you entered is not valid");
					 		alert('Apikey not valid');
					 	}else{
					 		$("#log").html("error");
					 	}
					}	

					});
				});



				$('#button-pst').click(function(){

					var apikey = $("#apikey").val();
					var country = $("#country-add").val();
					var year = $("#year-add").val();
		  			var for_all_crimes = $("#for-all-add").val();
		  			var murder_rate_per_100k_people = $("#rate-add").val();

					var request = $.ajax({

						  url: "http://sos-2016-12.herokuapp.com/api/v1/death_penalty_stats?apikey="+apikey,
						  type: "POST",
						  data: '{"country":"'+country+'","abolition_year":'+year+',"for_all_crimes":"'+for_all_crimes+'","murder_rate_per_100k_people":'+murder_rate_per_100k_people+'}',
						  contentType: "application/json"
  
					});


					request.done(function(data,status,jqXHR) {
					  // Tratamiento en caso de exito
					 
					  	var trHTML = '';


       					$.each(data, function (i, item) {
            
            			trHTML += '<tr id="'+id+'"><td>'+ id +'</td><td>'+ country + '</td><td>' + abolition_year + '</td><td>' + for_all_crimes + '</td><td>'
            			+ murder_rate_per_100k_people + '</td><td> <button type="button" id="button-upd" class="btn btn-primary" autocomplete="off"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> Update </button> </td><td> <button type="button" id="button-dlt" class="btn btn-primary" autocomplete="off"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span> Delete </button> </td></tr>';
       					 id++;
       					 });
        
       					$('#table').append(trHTML);
					 	$("#status").html(jqXHR.status);
					 	$("#log").html("You added a new resource successfully.");

					});

					request.always(function(jqXHR, status) {
					  // Tratamiento en cualquier caso
					 if(status == "error") {
						$("#status").html(jqXHR.status);
					 	console.log(jqXHR.status);
					 	if (jqXHR.status == 401) {
					 		$("#log").html("The apikey you entered is not valid");
					 		alert('Apikey not valid');
					 	}else if (jqXHR.status == 409){
					 		$("#log").html("The resource you entered already exists");
					 		alert('The resource you entered already exists.');
					 	}else{
					 		$("#log").html("error");					 		
					 	}
					}	

					});
				});





				$('#button-upd').click(function(){

					var apikey = $("#apikey").val();

					var row = $("#button-upd").closest("tr");        // Finds the closest row <tr> 

					var identifier = row.find("td:nth-child(2)").val();

					

					var request = $.ajax({

						  url: "http://sos-2016-12.herokuapp.com/api/v1/death_penalty_stats/"+identifier+"?apikey="+apikey,
						  type: "PUT",
						  data: '{"country":"'+country+'","abolition_year":'+year+',"for_all_crimes":"'+for_all_crimes+'","murder_rate_per_100k_people":'+murder_rate_per_100k_people+'}',
						  contentType: "application/json"
  
					});


					request.done(function(data,status,jqXHR) {
					  // Tratamiento en caso de exito
					  
					 $("#status").html(jqXHR.status);
					 $("#log").html("done");

					});

					request.always(function(jqXHR, status) {
					  // Tratamiento en cualquier caso
					 if(status == "error") {
						$("#status").html(jqXHR.status);
					 	console.log(jqXHR.status);
					 	if (jqXHR.status == 401) {
					 		$("#log").html("The apikey you entered is not valid");
					 		alert('Apikey not valid');
					 	}else{
					 		$("#log").html("error");
					 	}
					}	

					});
				});




				$('#button-dlt').click(function(){

					var apikey = $("#apikey").val();

					var request = $.ajax({

						  url: "http://sos-2016-12.herokuapp.com/api/v1/death_penalty_stats?apikey="+apikey,
						  type: "DELETE",
						  contentType: "application/json",
  
					});


					request.done(function(data,status,jqXHR) {
					  // Tratamiento en caso de exito
					  
					 $("#status").html(jqXHR.status);
					 $("#log").html("done");

					});

					request.always(function(jqXHR, status) {
					  // Tratamiento en cualquier caso
					 if(status == "error") {
						$("#status").html(jqXHR.status);
					 	console.log(jqXHR.status);
					 	if (jqXHR.status == 401) {
					 		$("#log").html("The apikey you entered is not valid");
					 		alert('Apikey not valid');
					 	}else{
					 		$("#log").html("error");
					 	}
					}	

					});
				});


				$('#button-dlt-all').click(function(){

					var apikey = $("#apikey").val();

					var request = $.ajax({

						  url: "http://sos-2016-12.herokuapp.com/api/v1/death_penalty_stats?apikey="+apikey,
						  type: "DELETE",
						  contentType: "application/json",
  
					});


					request.done(function(data,status,jqXHR) {
					  // Tratamiento en caso de exito
					 
					 $("table").find("tr:gt(0)").remove();

					 $("#status").html(jqXHR.status);
					 $("#log").html("You deleted all resources.");

					});

					request.always(function(jqXHR, status) {
					  // Tratamiento en cualquier caso
					if(status == "error") {
						$("#status").html(jqXHR.status);
					 	console.log(jqXHR.status);
					 	if (jqXHR.status == 401) {
					 		$("#log").html("The apikey you entered is not valid");
					 		alert('Apikey not valid');
					 	}else{
					 		$("#log").html("error");
					 	}
					}

					});
				});

 			});
		</script>
	</head>




	<body><div class="container">
		<h1>JQuery REST Client</h1>
		</br>
		<button type="button" id="button-get" class="btn btn-primary" autocomplete="off"><span class="glyphicon glyphicon-triangle-right" aria-hidden="true"></span> GET All Resources </button>
		<button type="button" id="button-ld-ini" class="btn btn-primary" autocomplete="off"><span class="glyphicon glyphicon-off" aria-hidden="true"></span> Load Initial Data </button>
		<label class="active" for="apikey"> Apikey </label>
		    <input id="apikey" name="apikey" type="text" value="1234">
		</br><hr/>
			<p class="lead">Message: <span id="log"></span></p>
		<hr/>
			<span id="data">
				<table id="table" border="1" class="table table-hover table-condensed table-bordered">
					<tr class="info">
						<th>ID</th>
       					<th>Country</th>
         				<th>Abolition Year</th>
         				<th>For All Crimes?</th>
         				<th>Murder Rate Per 100k People</th>
         				<th>Update</th>
         				<th>Delete</th>
    				</tr>
				</table>
			</span>
			<button type="button" id="button-dlt-all" class="btn btn-primary" autocomplete="off"><span class="glyphicon glyphicon-fire" aria-hidden="true"></span> Delete All Data </button>
				<hr/>
			<form class="form-inline">
  				<div class="form-group">
    				<label class="sr-only">Country</label>
    					<input type="text" class="form-control" id="country-add" placeholder="Country">
 				</div>
 				<div class="form-group">
  					<label class="sr-only">Abolition Year</label>
    					<input type="text" class="form-control" id="year-add" placeholder="Abolition Year">
  				</div>
  				<div class="form-group">
  					<label class="sr-only">For All Crimes?</label>
    					<input type="text" class="form-control" id="for-all-add" placeholder="For All Crimes?">
  				</div>
  				<div class="form-group">
  					<label class="sr-only">Murder Rate</label>
    					<input type="text" class="form-control" id="rate-add" placeholder="Murder Rate">
  				</div>
  				<button type="button" id="button-pst" class="btn btn-primary"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span>Add new data</button>
			</form>
			<hr/>			
			<p class="lead">HTTP Status: <span id="status"></span></p>
	</div></body>
</html>